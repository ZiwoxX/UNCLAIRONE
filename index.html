<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta id="viewportMeta" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" /> 
  <title>10 C.1 GANK - Detail Siswa</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  
 <style>
    /* ... (CSS BAWAAN) ... */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a0b2e 0%, #0f1419 100%);
      min-height: 100vh;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px; 
      overflow-x: hidden; 
    }

    /* --- CSS HYPERLINK (NAVIGASI) --- */
    .nav-link-left { 
        position: absolute;
        top: 20px;
        left: 20px;
        color: #bdb6f0;
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        padding: 5px 10px;
        border-radius: 8px;
        background: rgba(106, 68, 216, 0.2);
        transition: background 0.3s, color 0.3s;
        z-index: 2; 
    }
    .nav-link-left:hover { background: #6a44d8; color: #ffffff; }
    
    .nav-link-right {
        position: absolute;
        top: 20px;
        right: 20px;
        color: #bdb6f0;
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        padding: 5px 10px;
        border-radius: 8px;
        background: rgba(106, 68, 216, 0.2);
        transition: background 0.3s, color 0.3s;
        z-index: 2;
    }
    .nav-link-right:hover { background: #6a44d8; color: #ffffff; }

    h1 {
      margin-bottom: 30px;
      font-weight: 700;
      font-size: 2.5rem;
      letter-spacing: 1.5px;
      color: #ffffff;
      text-shadow: 0 0 10px #6a44d8;
      margin-top: 40px; 
      text-align: center;
    }

    /* --- STYLE QUOTE OF THE DAY --- */
    .quote-box {
        background: rgba(255, 255, 255, 0.05);
        border-left: 5px solid #ff775c; 
        border-radius: 15px;
        padding: 20px 30px;
        margin: 0 auto 25px auto; 
        max-width: 800px;
        width: 90%;
        text-align: center;
        position: relative;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        backdrop-filter: blur(5px);
        transition: transform 0.3s;
    }
    .quote-box:hover {
        transform: scale(1.02);
        background: rgba(255, 255, 255, 0.08);
    }
    .quote-icon {
        font-size: 1.5rem;
        color: #ff775c;
        margin-bottom: 10px;
        opacity: 0.8;
    }
    .quote-text {
        font-size: 1.1rem;
        font-style: italic;
        line-height: 1.6;
        margin: 0;
        color: #e0e0e0;
        font-weight: 300;
    }
    .quote-author {
        margin-top: 10px;
        font-weight: 700;
        color: #bdb6f0;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* ========================================= */
    /* --- STYLE RUNNING QUOTES (HYBRID SCROLL) --- */
    /* ========================================= */
    .running-quotes-wrapper {
        width: 100%;
        overflow-x: auto; 
        margin-bottom: 40px;
        padding: 20px 0;
        position: relative;
        background: linear-gradient(to right, rgba(106, 68, 216, 0.05), rgba(0, 0, 0, 0.2), rgba(106, 68, 216, 0.05));
        border-top: 1px solid rgba(106, 68, 216, 0.4);
        border-bottom: 1px solid rgba(106, 68, 216, 0.4);
        box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
        cursor: grab; 
        -ms-overflow-style: none;  
        scrollbar-width: none;  
    }
    .running-quotes-wrapper::-webkit-scrollbar {
        display: none; 
    }
    
    .running-track {
        display: flex;
        width: max-content;
        padding-left: 20px;
        white-space: nowrap; 
    }
    
    .student-quote-card {
        background: linear-gradient(145deg, #2a1b3d, #151525);
        border-left: 3px solid #7e62ff;
        border-radius: 10px;
        padding: 15px 20px;
        margin: 0 15px;
        min-width: 240px;
        max-width: 350px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        cursor: pointer; 
        user-select: none; 
        min-height: 120px; 
        height: auto; 
        box-sizing: border-box; 
    }
    
    .running-quotes-wrapper.active-drag {
        cursor: grabbing;
    }

    .student-quote-card:hover {
        transform: scale(1.05) translateY(-5px);
        background: linear-gradient(145deg, #35224d, #1d1d33);
        border-left-color: #ff775c;
        box-shadow: 0 10px 25px rgba(0,0,0,0.5), 0 0 15px rgba(255, 119, 92, 0.4);
        z-index: 2;
    }
    
    .student-quote-card:active {
        transform: scale(0.95);
    }

    .sq-text {
        font-style: italic;
        font-size: 0.95rem;
        color: #e0e0e0;
        margin-bottom: 10px;
        line-height: 1.5;
        pointer-events: none; 
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 4; 
        overflow: hidden;
        text-overflow: ellipsis; 
    }

    .sq-author {
        font-weight: 600;
        font-size: 0.85rem;
        color: #bdb6f0;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        pointer-events: none;
    }
    
    .sq-author img {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px;
        border: 2px solid #7e62ff;
        box-shadow: 0 0 5px rgba(106, 68, 216, 0.5);
    }
    
    .student-quote-card:hover .sq-author img {
        border-color: #ff775c;
    }
    
    /* --- STYLE STATISTIK KELAS --- */
    .stats-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 0 auto 30px auto; 
        width: 90%;
        max-width: 800px;
    }
    .stat-box {
        background: rgba(126, 98, 255, 0.1);
        border: 1px solid #7e62ff;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        flex: 1;
        min-width: 150px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: transform 0.3s;
    }
    .stat-box:hover {
        transform: translateY(-5px);
        background: rgba(126, 98, 255, 0.2);
    }
    .stat-box i {
        font-size: 1.5rem;
        color: #ff775c;
        margin-bottom: 5px;
    }
    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #ffffff;
        display: block;
    }
    .stat-label {
        font-size: 0.8rem;
        color: #bdb6f0;
        margin-top: 5px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* --- PENCARIAN UI BARU --- */
    .filter-controls {
        display: flex;
        justify-content: center; 
        width: 100%;
        max-width: 500px; 
        margin: 0 auto 30px auto; 
    }

    .search-container {
        width: 100%; 
        position: relative;
        border-radius: 8px; 
        background: #1a1a2e; 
        box-shadow: 0 0 15px rgba(255, 119, 92, 0.4); 
        border: 1px solid #ff775c; 
        display: flex; 
        align-items: stretch; 
        padding: 0;
    }
    #searchInput {
        flex-grow: 1;
        width: 100%;
        padding: 12px 15px; 
        border-radius: 8px 0 0 8px; 
        border: none; 
        background: transparent; 
        color: #e0e0e0;
        font-size: 1rem;
        transition: background 0.3s;
    }
    #searchInput:focus {
        outline: none;
        background: rgba(42, 27, 61, 0.5); 
    }

    .search-button-area {
        padding: 12px 15px;
        background: #ff775c; 
        border-radius: 0 8px 8px 0; 
        cursor: pointer;
        transition: background 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0; 
    }
    .search-button-area:hover {
        background: #e05d47; 
    }
    .search-button-area .fa-search {
        color: #1a1a2e; 
        font-size: 1.1rem;
        position: static; 
        transform: none;
    }
    
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 25px;
      width: 100%;
      max-width: 1300px;
    }

    /* --- Card Siswa --- */
    .card {
      background: linear-gradient(145deg, #2a1b3d, #1a1a2e);
      border-radius: 25px;
      box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.5),
                  -8px -8px 20px rgba(106, 68, 216, 0.1);
      overflow: hidden;
      color: #e0e0e0;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 25px;
      border: 1px solid #4a3c7a;
      cursor: pointer; 
      opacity: 0;
      transform: translateY(20px);
      animation-fill-mode: forwards;
      position: relative; /* WAJIB UNTUK BADGE LIKE */
    }

    .card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 12px 12px 30px rgba(0,0,0,0.7),
                  -12px -12px 30px rgba(106, 68, 216, 0.2);
    }

    .card.animate {
      animation-name: fadeSlideUp;
      animation-duration: 0.6s;
      animation-timing-function: ease-out;
    }

    /* STYLE BARU: BADGE LIKE DI CARD */
    .card-like-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        color: #ff775c; /* Warna oranye neon */
        padding: 5px 10px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.9rem;
        border: 1px solid rgba(255, 119, 92, 0.5);
        display: flex;
        align-items: center;
        gap: 6px;
        z-index: 2; /* Di atas foto */
        box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    
    .card-like-badge i {
        font-size: 1rem;
    }

    @keyframes fadeSlideUp {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .photo {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 25px #6a44d8;
      border: 4px solid #7e62ff;
      margin-bottom: 20px;
      background-color: #3d2c66;
    }

    .name { font-weight: 700; font-size: 1.3rem; margin-bottom: 10px; text-align: center; color: #ffffff; }
    .info { font-size: 0.95rem; line-height: 1.4; text-align: center; margin-bottom: 5px; }
    .label { font-weight: 600; color: #bdb6f0; }
    .ig-label { display: block; text-align: center; margin-bottom: 2px; }
    
    .description { 
        font-size: 0.85rem; 
        line-height: 1.3; 
        text-align: center; 
        margin-top: 10px; 
        padding: 5px 0 10px 0; 
        border-top: 1px solid rgba(189, 182, 240, 0.2); 
        color: #bdb6f0; 
        font-style: italic;
    }

    .instagram-link {
      color: #bdb6f0;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex; 
      align-items: center; 
      justify-content: center; 
    }
    .instagram-link::before {
      content: '\f16d'; 
      font-family: 'Font Awesome 6 Brands';
      margin-right: 6px; 
      color: #7e62ff;
    }
    .instagram-link:hover { color: #7e62ff; text-decoration: underline; }

    /* --- Style Modal / Pop-up --- */
    .modal {
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s;
      display: none; 
      justify-content: center; 
      align-items: center; 
      overflow-y: auto; 
      padding: 0; 
    }

    .modal-content {
      background: linear-gradient(160deg, #2a1b3d 5%, #151525 100%);
      padding: 30px;
      border-radius: 25px;
      box-shadow: 0 0 50px rgba(106, 68, 216, 0.8);
      width: 90%;
      max-width: 800px;
      position: relative;
      color: #e0e0e0;
      animation: slideIn 0.4s ease-out; 
      border: 2px solid #6a44d8;
      max-height: 95vh; 
      overflow-y: auto; 
      margin: auto; 
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .close-btn {
      color: #bbb;
      position: absolute; 
      top: 15px;
      right: 25px;
      font-size: 35px;
      font-weight: bold;
      transition: color 0.3s;
      cursor: pointer;
      z-index: 10; 
    }
    .close-btn:hover { color: #7e62ff; }

    .modal-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #4a3c7a; padding-bottom: 10px; }
    .modal-photo {
      width: 150px; height: 150px; border-radius: 50%; object-fit: cover;
      border: 5px solid #7e62ff; box-shadow: 0 0 30px rgba(106, 68, 216, 0.5); margin-bottom: 15px;
    }
    .modal-name { font-size: 2rem; font-weight: 700; color: #ffffff; }
    
    .modal-details {
      display: flex; flex-direction: column; gap: 10px; margin-top: 20px;
      padding: 10px; border-radius: 10px; background: #1a1a2e; border-left: 5px solid #6a44d8;
    }
    .modal-details p { margin: 0; line-height: 1.6; }
    .modal-details .label { color: #7e62ff; font-weight: 700; width: 100px; display: inline-block; }

    /* ========================================= */
    /* --- STYLE BARU: LIKE & COMMENT --- */
    /* ========================================= */
    .interaction-section {
        margin-top: 20px;
        border-top: 1px solid #4a3c7a;
        padding-top: 20px;
    }

    /* Like Button */
    .like-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        font-size: 1.2rem;
        color: #bdb6f0;
    }

    .like-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #ff775c;
        color: #ff775c;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .like-btn:hover {
        background: #ff775c;
        color: white;
        transform: scale(1.1);
    }

    .like-btn.liked {
        background: #ff775c;
        color: white;
        box-shadow: 0 0 15px rgba(255, 119, 92, 0.6);
    }

    /* Comment Section */
    .comments-wrapper h4 {
        color: #bdb6f0;
        margin-bottom: 15px;
        border-left: 3px solid #7e62ff;
        padding-left: 10px;
    }

    .comments-list {
        max-height: 200px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #4a3c7a;
    }

    .comment-item {
        background: #1a1a2e;
        padding: 8px 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        font-size: 0.9rem;
        border-left: 2px solid #7e62ff;
    }

    .comment-header {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: #bdb6f0;
        margin-bottom: 4px;
        font-weight: bold;
    }

    .comment-text {
        color: #e0e0e0;
        word-wrap: break-word;
    }

    .no-comments {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 20px;
    }

    /* Form Input Komentar */
    .comment-form {
        display: flex;
        gap: 10px;
    }

    .comment-form input {
        flex: 1;
        padding: 10px;
        border-radius: 20px;
        border: 1px solid #4a3c7a;
        background: #151525;
        color: white;
        outline: none;
    }

    .comment-form input:focus {
        border-color: #7e62ff;
    }

    .send-comment-btn {
        background: #7e62ff;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .send-comment-btn:hover {
        background: #6a44d8;
        transform: scale(1.1);
    }
    /* ========================================= */

    /* Style Galeri Foto */
    .photo-gallery { margin-top: 30px; }
    .photo-gallery h3 { color: #bdb6f0; border-bottom: 1px solid #4a3c7a; padding-bottom: 5px; margin-bottom: 15px; font-weight: 600; }
    .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
    .gallery-img {
      width: 100%; height: 100px; object-fit: cover; border-radius: 10px;
      transition: transform 0.3s ease; border: 2px solid #4a3c7a; cursor: pointer;
    }
    .gallery-img:hover { transform: scale(1.05); border-color: #7e62ff; }

    /* --- LightBox --- */
    .lightbox {
      display: none; position: fixed; z-index: 200; left: 0; top: 0;
      width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.9);
      animation: fadeIn 0.3s; justify-content: center; align-items: center; 
    }
    .lightbox-content {
      width: auto; height: auto; max-width: 90%; max-height: 90vh; 
      display: block; border-radius: 10px; box-shadow: 0 0 20px rgba(106, 68, 216, 0.5);
      animation: zoomIn 0.4s; margin: auto; 
      transition: opacity 0.15s ease-in-out; 
    }
    @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .lightbox-close-btn {
      position: absolute; top: 15px; right: 35px; color: #f1f1f1;
      font-size: 40px; font-weight: bold; cursor: pointer;
    }

    .lightbox-nav-btn {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        margin-top: -22px;
        color: white;
        font-weight: bold;
        font-size: 25px; 
        transition: 0.6s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0.8;
        z-index: 201; 
    }

    .lightbox-nav-btn.prev {
        left: 0;
        border-radius: 0 4px 4px 0;
    }

    .lightbox-nav-btn.next {
        right: 0;
        border-radius: 4px 0 0 4px;
    }

    .lightbox-nav-btn:hover {
        background-color: rgba(0, 0, 0, 0.8);
        opacity: 1;
    }

    
    /* --- KONTROL SPOTIFY (CSS BARU DENGAN ANIMASI SLIDE) --- */
    #toggleButton {
        position: fixed; 
        bottom: 20px; 
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #1DB954; 
        color: white;
        border: none;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(29, 185, 84, 0.6);
        z-index: 12; 
        transition: background-color 0.3s, transform 0.3s;
    }

    #toggleButton:hover {
        background-color: #1ed760;
        transform: scale(1.05);
    }

    #toggleButton i {
        transition: transform 0.3s ease;
    }

    #spotifyPlayerContainer.open + #toggleButton i,
    #toggleButton.open i { 
        transform: rotate(180deg);
    }
    
    #spotifyPlayerContainer {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 11; 
        box-shadow: none; 
        border-radius: 12px;
        overflow: visible; 
        transition: transform 0.4s ease-out;
        transform: translateY(100px); 
    }

    #spotifyPlayerContainer.open {
        transform: translateY(-90px); 
    }

    #spotifyPlayerContainer iframe {
        margin-bottom: 0; 
        box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        transition: box-shadow 0.4s;
        border-radius: 12px;
    }

    /* --- MODIFIKASI: STYLE KHUSUS UNTUK POP-UP QUOTE --- */
    .quote-modal-content {
        text-align: center;
        border: 3px solid #ff775c;
        max-width: 500px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 25px;
    }
    
    .quote-modal-icon {
        font-size: 3rem;
        color: #ff775c;
        margin-bottom: 20px;
    }

    .quote-modal-text {
        font-size: 1.4rem;
        font-style: italic;
        line-height: 1.5;
        margin-bottom: 25px;
        color: #ffffff;
    }

    .quote-modal-author {
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(126, 98, 255, 0.1);
        padding: 10px 20px;
        border-radius: 50px;
        border: 1px solid #7e62ff;
    }

    .quote-modal-author img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 15px;
        border: 2px solid #ffffff;
    }
    
    .quote-modal-author span {
        font-weight: 700;
        color: #bdb6f0;
        font-size: 1.1rem;
    }

    /* --- CSS BARU UNTUK FITUR MENFESS --- */
    #menfessButton {
        position: fixed;
        bottom: 80px; 
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #ff775c; 
        color: white;
        border: none;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(255, 119, 92, 0.6);
        z-index: 12; 
        transition: background-color 0.3s, transform 0.3s;
    }

    #menfessButton:hover {
        background-color: #e05d47;
        transform: scale(1.05);
    }
    
    .menfess-modal-content {
        max-width: 600px;
        padding: 25px;
        border: 3px solid #ff775c;
        animation: slideIn 0.4s ease-out; 
    }

    .menfess-form h3 {
        color: #ff775c;
        margin-top: 0;
        border-bottom: 1px solid rgba(255, 119, 92, 0.3);
        padding-bottom: 10px;
    }

    .menfess-form label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        color: #bdb6f0;
        font-weight: 600;
    }

    .menfess-form input[type="text"],
    .menfess-form textarea {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        border: 1px solid #4a3c7a;
        background: #1a1a2e;
        color: #e0e0e0;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    .menfess-form input[type="text"]:focus,
    .menfess-form textarea:focus {
        outline: none;
        border-color: #ff775c;
    }

    .menfess-form textarea {
        resize: vertical;
        min-height: 120px;
    }
    
    .menfess-submit-btn {
        display: block;
        width: 100%;
        padding: 12px;
        margin-top: 20px;
        background-color: #7e62ff;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.1s;
    }

    .menfess-submit-btn:hover {
        background-color: #6a44d8;
    }

    /* --- DISPLAY MENFESS --- */
    #menfessSection {
        width: 100%;
        max-width: 1300px;
        margin: 40px auto 60px auto;
        padding-top: 20px;
        border-top: 2px dashed rgba(126, 98, 255, 0.4);
    }

    #menfessSection h2 {
        text-align: center;
        color: #ff775c;
        font-size: 2rem;
        margin-bottom: 30px;
    }

    .menfess-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        padding: 0 10px;
    }

    .menfess-card {
        background: linear-gradient(145deg, #35224d, #1d1d33);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        border: 1px solid #7e62ff;
        display: flex;
        flex-direction: column;
        transition: transform 0.3s;
    }

    .menfess-card:hover {
        transform: translateY(-3px) scale(1.01);
        box-shadow: 0 10px 25px rgba(0,0,0,0.7);
    }
    
    .menfess-to {
        font-weight: 700;
        color: #ff775c;
        font-size: 1.1rem;
        margin-bottom: 10px;
        border-bottom: 1px dashed rgba(255, 119, 92, 0.5);
        padding-bottom: 5px;
    }

    .menfess-content {
        font-style: italic;
        color: #e0e0e0;
        line-height: 1.5;
        flex-grow: 1; /* Agar konten mengisi ruang */
        margin-bottom: 15px;
    }

    .menfess-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: #bdb6f0;
        margin-top: auto; 
        padding-top: 10px;
        border-top: 1px solid rgba(189, 182, 240, 0.2);
    }

    .menfess-from {
        font-weight: 600;
    }
    
    .menfess-date {
        font-style: normal;
        font-size: 0.8rem;
    }

    /* --- Optimasi Mobile --- */
    @media (max-width: 600px) {
      body {
        padding: 0; 
        padding-top: 50px; 
        padding-bottom: 20px;
        align-items: center; 
      }
      
      .card { padding: 20px; }
      .photo { width: 110px; height: 110px; }
      h1 { font-size: 2rem; margin-top: 20px; }
      
      .nav-link-left { top: 10px; left: 10px; font-size: 0.9rem; padding: 3px 8px; }
      
      .nav-link-right { 
        top: 10px; 
        right: 10px; 
        font-size: 0.9rem; 
        padding: 3px 8px;
        max-width: 50%; 
        overflow: hidden; 
        text-overflow: ellipsis; 
        white-space: nowrap;
      }
      
      .quote-box {
          width: 95%; 
          margin: 15px auto 15px auto; 
          box-sizing: border-box; 
      }
      
      .quote-text { font-size: 1rem; } 
      
      .stats-container {
          flex-direction: column;
          gap: 15px;
          width: 95%; 
          margin: 0 auto 30px auto;
          box-sizing: border-box;
      }
      .filter-controls {
          padding: 0; 
          max-width: 100%; 
          width: 95%; 
          margin: 0 auto 30px auto; 
          box-sizing: border-box;
      }
      
      .search-container {
          width: 100%; 
          max-width: 100%; 
          border-radius: 8px;
      }
      #searchInput {
          padding: 12px 10px; 
          font-size: 1rem; 
          border-radius: 8px 0 0 8px;
      }
      .search-button-area {
          padding: 12px 10px; 
          border-radius: 0 8px 8px 0;
      }

      .container {
        padding: 0; 
        gap: 15px; 
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
        max-width: 100%;
        width: 95%; 
        margin: 0 auto; 
      }
      
      .modal-content { padding: 20px 15px; width: 95%; }
      .modal-name { font-size: 1.5rem; }
      .modal-photo { width: 100px; height: 100px; }
      .gallery-grid { grid-template-columns: repeat(3, 1fr); }
      
      .lightbox-nav-btn {
          font-size: 20px;
          padding: 10px;
      }
      
      #spotifyPlayerContainer, #toggleButton {
          bottom: 10px;
          right: 10px;
      }
      #toggleButton {
          width: 45px;
          height: 45px;
      }
      
      .running-quotes-wrapper {
          padding: 15px 0;
      }
      .student-quote-card {
          min-width: 210px;
          padding: 12px 15px;
          margin: 0 10px;
          min-height: 110px; 
      }

      .sq-text { font-size: 0.85rem; }

      .quote-modal-text { font-size: 1.1rem; }
      .quote-modal-author img { width: 30px; height: 30px; }
      .quote-modal-author span { font-size: 0.9rem; }

      #menfessButton {
            bottom: 70px; 
            right: 10px;
            width: 45px;
            height: 45px;
      }
    }
  </style>
  
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

</head>
<body>
  
  <button id="toggleButton" aria-label="Buka/Tutup Spotify Player">
      <i class="fab fa-spotify"></i> 
  </button>
  
  <div id="spotifyPlayerContainer">
      <iframe 
          id="spotifyIframe"
          style="border-radius:12px; transition: box-shadow 0.4s;" 
          src="" 
          width="300" 
          height="80" 
          frameBorder="0" 
          allowfullscreen="" 
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy">
      </iframe>
  </div>

  <button id="menfessButton" aria-label="Tulis Menfess Baru">
      <i class="fas fa-paper-plane"></i> 
  </button>
  
  <a href="https://xcerdas1.vercel.app/" class="nav-link-left">Home / Beranda</a>
  <a href="prestasi.html" class="nav-link-right">Prestasi Kelas üèÜ</a>

  <h1>UNCLAIRONE STUDENTS</h1>
  
  <div class="quote-box">
      <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
      <p id="dailyQuote" class="quote-text">Loading quote...</p>
      <p id="dailyAuthor" class="quote-author"></p>
  </div>

  <div class="running-quotes-wrapper">
      <div class="running-track" id="studentQuotesTrack">
      </div>
  </div>

  <div class="stats-container">
    <div class="stat-box">
        <i class="fas fa-users"></i>
        <span id="statTotalStudents" class="stat-value">36</span>
        <span class="stat-label">Total Siswa</span>
    </div>
    <div class="stat-box">
        <i class="fas fa-birthday-cake"></i>
        <span id="statBirthdayMonth" class="stat-value">0</span>
        <span class="stat-label">Ultah Bulan Ini</span>
    </div>
    <div class="stat-box">
        <i class="fas fa-trophy"></i>
        <span id="statMostOrganization" class="stat-value">Paskibra (6)</span>
        <span class="stat-label">Org. Terbanyak</span>
    </div>
  </div>

  <div class="filter-controls">
      <div class="search-container">
          <input type="text" id="searchInput" onkeyup="filterStudents()" placeholder="Cari nama siswa..." aria-label="Cari nama siswa">
          <div class="search-button-area">
              <i class="fas fa-search"></i>
          </div>
      </div>
  </div>

  <div class="container" id="studentContainer"></div>
  
  <div id="menfessSection">
    <h2>Pesan Rahasia Kelas (Menfess)</h2>
    <div id="menfessGrid" class="menfess-grid">
        <p style="text-align: center; color: #bdb6f0; width: 100%; grid-column: 1 / -1;">Memuat menfess...</p>
    </div>
  </div>

  <div id="studentModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeStudentModal()">√ó</span>
      <div class="modal-header">
        <img id="modalPhoto" class="modal-photo" src="" alt="" title="" /> 
        <h2 id="modalName" class="modal-name"></h2>
      </div>
      
      <div class="modal-details">
        <p><span class="label">Umur:</span> <span id="modalAge"></span> tahun</p>
        <p><span class="label">Hobi:</span> <span id="modalHobby"></span></p>
        <p><span class="label">Instagram:</span> 
          <a id="modalInstagramLink" href="#" target="_blank" class="instagram-link">@<span id="modalInstagramHandle"></span></a>
        </p>
        <p><span class="label">Agama:</span> <span id="modalReligion"></span></p>
        <p><span class="label">Organisasi:</span> <span id="modalOrganization"></span></p>
      </div>

      <div class="interaction-section">
          <div class="like-container">
              <button id="likeBtn" class="like-btn" onclick="handleLike()">
                  <i class="far fa-heart" id="likeIcon"></i>
              </button>
              <span id="likeCountValue">0</span> Likes
          </div>

          <div class="comments-wrapper">
              <h4>Komentar Teman</h4>
              <div id="commentsList" class="comments-list">
                  <p class="no-comments">Belum ada komentar.</p>
              </div>

              <div class="comment-form">
                  <input type="text" id="commentInput" placeholder="Tulis komentar..." maxlength="150">
                  <button onclick="handleComment()" class="send-comment-btn">
                      <i class="fas fa-paper-plane"></i>
                  </button>
              </div>
          </div>
      </div>
      <div class="photo-gallery">
          <h3>Galeri Foto Lainnya (Klik untuk memperbesar)</h3>
          <div class="gallery-grid" id="modalGallery"></div>
      </div>
    </div>
  </div>

  <div id="birthdayModal" class="modal" style="display: none; z-index: 9999;">
    <div class="modal-content" style="text-align: center; border: 3px solid #ff4359; max-width: 500px;">
        <span class="close-btn" onclick="closeBirthdayModal()">√ó</span>
        <div style="font-size: 4rem; margin-bottom: 10px;">üéâ</div>
        <h2 style="color: #ff775c; font-size: 2rem; margin-bottom: 10px;">Selamat Habede</h2>
        <p style="font-size: 1.2rem;">Selamat habede untuk:</p>
        
        <div id="birthdayPerson" style="margin: 20px 0; display: flex; flex-direction: column; align-items: center;"></div>
        
        <p style="color: #bdb6f0;">Semoga panjang umur dan sehat eperitaym</p>
        <button onclick="closeBirthdayModal()" style="margin-top: 20px; padding: 10px 25px; background: #ff4359; color: white; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 1rem;">Aamiin üôè</button>
    </div>
  </div>

  <div id="quoteModal" class="modal" style="z-index: 150;">
    <div class="modal-content quote-modal-content">
        <span class="close-btn" onclick="closeQuoteModal()">√ó</span>
        <div class="quote-modal-icon"><i class="fas fa-quote-left"></i></div>
        <p id="quoteModalText" class="quote-modal-text"></p>
        <div class="quote-modal-author">
            <img id="quoteModalPhoto" src="" alt="">
            <span id="quoteModalName"></span>
        </div>
    </div>
  </div>

  <div id="menfessModal" class="modal" style="z-index: 160;">
    <div class="modal-content menfess-modal-content">
        <span class="close-btn" onclick="closeMenfessModal()">√ó</span>
        <form id="menfessForm" class="menfess-form">
            <h3>Kirim Pesan Rahasia (Menfess)</h3>
            
            <label for="menfessTo">Kepada Siapa? (Contoh: Akil, All, Admin)</label>
            <input type="text" id="menfessTo" required placeholder="Nama Siswa / All / Lainnya">

            <label for="menfessContent">Isi Pesanmu</label>
            <textarea id="menfessContent" required minlength="10" maxlength="5000" placeholder="Tuliskan menfess-mu di sini (maks. 5000 karakter)"></textarea>

            <label for="menfessFrom">Dari (Opsional)</label>
            <input type="text" id="menfessFrom" placeholder="Nama samaran atau Anonim (default: Anonim)">

            <button type="submit" class="menfess-submit-btn">Kirim Menfess</button>
        </form>
    </div>
  </div>


  <div id="lightbox" class="lightbox">
    <span class="lightbox-close-btn">√ó</span>
    <img class="lightbox-content" id="lightboxImage" alt="" title=""> 
  </div>


  <script>
    // ==========================================
    // ** LOGIKA UTAMA **
    // ==========================================
    
    const firebaseConfig = {
      apiKey: "AIzaSyAnouQgMTahiA0R3pyKb6n_qHYFhX4tfgU",
      authDomain: "website-25711.firebaseapp.com",
      databaseURL: "https://website-25711-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "website-25711",
      storageBucket: "website-25711.appspot.com",
      messagingSenderId: "38660762483",
      appId: "1:38660762483:web:8f0fa0be46a2e901ceb306",
      measurementId: "G-6VB4PRBFYV"
    };

    // Inisialisasi Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = app.firestore();

    // ** DATA SISWA **
   const students = [
      {
        name: "Ainun Mardiansyah",
        age: 16,
        hobby: "Gatahu",
        instagram: "4inunranii_",
        photo: "image/Ainun.jpg",
        religion: "Islam",
        organization: "Inteens", 
        gallery: [],
        birthDate: "03-13",
        description: "Najim hotspott 1",
        quote: "The best way to predict the future is to create it." 
      },
      {
        name: "Akifa Naila",
        age: 16,
        hobby: "Minta hotspot",
        instagram: "akiipanaila",
        photo: "image/Naila.jpg",
        religion: "Islam",
        organization: "OSIS",
        gallery: [],
        birthDate: "05-15",
        description: "Najim hotspot 2",
        quote: "Every moment is a fresh beginning."
      },
      {name: "Akil Maula S", age: 16, hobby: "Mancing", instagram: "kikiuuuz", photo: "image/Akil.jpg", religion: "Islam", organization: "SEGA", gallery: [], birthDate: "12-31", description: "Starboy, Cool, Jenius, Proplayer epep", quote: "Know yourself, and be the best of yourself."},
      {name: "Amirah Zafirah", age: 15, hobby: "Yapping", instagram: "amirahpspra", photo: "image/Amirah.jpg", religion: "Islam", organization: "Paskibra", gallery: [], birthDate: "03-22", description: "Duta Yapping", quote: "Appreciate every process, because everything has its time."},
      {name: "Andi Naurah", age: 16, hobby: "Nonton Windah", instagram: "nauurahkhalilah", photo: "image/Naura.jpg", religion: "Islam", organization: "KITS/Sega/Sanggar Seni", gallery: [], birthDate: "04-22", description: "pendek", quote: "What are you so afraid of losing when nothing in this world belongs to you."},
      {name: "Anindya Ainun", age: 15, hobby: "gatau", instagram: "_anindyainun", photo: "image/Ainun purba.jpg", religion: "Islam", organization: "Smansa Voice", gallery: [], birthDate: "03-15", description: "tida mau diambil aibnya", quote: "Love the life you live, live the life you love."},
      {name: "Annisa Maylafaiza", age: 16, hobby: "Minta Hotspots", instagram: "annisamaylaa_", photo: "image/Anisa.jpg", religion: "Islam", organization: "Sanggar Seni", gallery: [], birthDate: "05-05", description: "Najim hotspot 3", quote: "Dont be afraid to try, because every small step brings you closer to your goal"},
      {name: "Aprilia Hastikasari", age: 16, hobby: "Bebeng", instagram: "liaaahyy", photo: "image/April.jpg", religion: "Islam", organization: "Pramuka", gallery: [], birthDate: "04-29", description: "Intropet", quote: "Every day is an opportunity to be the best version of yourself."},
      {name: "Clarinta Amabel", age: 15, hobby: "Gemar Makan Batagor", instagram: "claebell", photo: "image/Aring.jpeg", religion: "Protestan", organization: "KITS/Inteens/Sega/PPKS", gallery: [], birthDate: "03-29", description: "Najim hotspot 4", quote: "The future is not waited for, but is shaped from today."},
      {name: "Dhia Syarafana", age: 16, hobby: "Slowmotion", instagram: "syeradelrey", photo: "image/Dhia.jpg", religion: "Islam", organization: "Tidak Ada", gallery: [], birthDate: "06-06", description: "Mati aja ni orang", quote: "Follow your dreams, not your boyfriends."},
      {name: "Fitri", age: 15, hobby: "yapping", instagram: "ffitri1_", photo: "image/Titi.jpg", religion: "Islam", organization: "Tidak Ada", gallery: [], birthDate: "01-11", description: "Gengster", quote: "Life is a journey, Enjoy the ride."},
      {name: "Hodia", age: 16, hobby: "Nonton Windah", instagram: "odiaa_a", photo: "image/Odi.jpg", religion: "Protestan", organization: "Sega/OSIS/Inteens", gallery: [], birthDate: "08-26", description: "Kakram Lovers", quote: "ùëÜùëùùëíùëéùëò ùëôùëíùë†ùë†, ùíçùíäùíîùíïùíÜùíè ùíéùíêùíìùíÜ. ùëÖùëíùëéùëêùë° ùëôùëíùë†ùë†, ùíêùíÉùíîùíÜùíìùíóùíÜ ùíéùíêùíìùíÜ."},
      {name: "Husnul Khatimah", age: 16, hobby: "Main sama Rasya", instagram: "hsnllkhtmh__", photo: "image/Husnul.jpg", religion: "Islam", organization: "Pramuka", gallery: [], birthDate: "03-17", description: "Misterius", quote: "..."},
      {name: "Miftahul", age: 16, hobby: "Minta Hotspot", instagram: "miftahuljannah1507_", photo: "image/Mita.jpg", religion: "Islam", organization: "Paskibra", gallery: [], birthDate: "07-15", description: "Najim hotspot 5", quote: "Learning is the key to opening the door to succes, make every lesson an opportunity to grow and develop."},
      {name: "Fathur Jibriel", age: 15, hobby: "Basket", instagram: "ndadapateuy", photo: "image/patur.jpg", religion: "Islam", organization: "Basket", gallery: [], birthDate: "", description: "Proplayer emel", quote: "Learn from the past, live in the present, and plan for the future"},
      {name: "Muh.Ibrahim", age: 15, hobby: "Takraw", instagram: "ibe_6610", photo: "image/Ibe.jpg", religion: "Islam", organization: "Paskibra", gallery: [], birthDate: "", description: "Pengganggu mati aja", quote: "Believe in yourself."}, 
      {name: "Muh.Tsaqiff", age: 15, hobby: "Main epep", instagram: "muhtsaqiffal", photo: "image/Tsaqif.jpg", religion: "Islam", organization: "Smansa Voice", gallery: [], birthDate: "", description: "Kul, Proplayer epep", quote: "Don't give up, keep fighting"},
      {name: "Muh.Alif Falah Jordan", age: 15, hobby: "Basket", instagram: "_alipjrdan", photo: "image/Alip.jpg", religion: "Islam", organization: "Basket", gallery: [], birthDate: "", description: "Pro player basket. Sering dipanggil Alip Jordang.", quote: "No pain, no gain."},
      {name: "Muh.Faiz Aswin", age: 15, hobby: "Bewan sama Akil", instagram: "mhmmdfaizz28", photo: "image/Faiz.jpg", religion: "Islam", organization: "Tidak Ada", gallery: [], birthDate: "02-28", description: "Cool, Tampan, Berwibawa, Gantenk, Rival Akil", quote: "There is always a way for those who want to try."},
      {name: "Kink Muflih", age: 15, hobby: "Nonton Anime", instagram: "muflih_zaky", photo: "image/Mupli.jpg", religion: "Islam", organization: "Tidak Ada", gallery: [], birthDate: "", description: "Rapper, Coach ML", quote: "It is obligatory to be good in the eyes of God, it is not necessary to look good in the eyes of humans."},
      {name: "M.Raihaan", age: 15, hobby: "Topup Dm", instagram: "rhnzki_16", photo: "image/Rehan.jpg", religion: "Islam", organization: "Putra Putri Smansa", gallery: [], birthDate: "", description: "Multiteleng", quote: "Character is formed in the stormy waves of the world."},
      {name: "Nagym", age: 15, hobby: "Tidur", instagram: "nagymm_", photo: "image/Nagym.jpg", religion: "Islam", organization: "KITS", gallery: [], birthDate: "06-23", description: "Tidur adalah koentji'.", quote: "Be Yourself And Never Surrender."},
      {name: "Naufal Qawwiy", age: 15, hobby: "Tektok Gn", instagram: "naufalqawiyy", photo: "image/nopal.jpg", religion: "Islam", organization: "Wasipalah", gallery: [], birthDate: "04-23", description: "Setarboy, Multiteleng, Jenius, Anak Gunung", quote: "Believe you can and you're halfway there."},
      {name: "Nur Nadya Afifah", age: 16, hobby: "Mengaji", instagram: "dyaafifah_", photo: "image/Afifah.jpg", religion: "Islam", organization: "Komunitas Pelajar Muslim", gallery: [], birthDate: "", description: "Misterius", quote: "Succes doesn't belong to smart people, succes belongs those who always try"},
      {name: "Nurfadillah Quinsya", age: 16, hobby: "nntndramaeverytaym", instagram: "nurfdilhqsya_", photo: "image/Nyonyo.jpg", religion: "Islam", organization: "Sanggar Seni", gallery: [], birthDate: "", description: "Kenalin ini Nyonyok", quote: "Always be grateful, and keep trying to be better."},
      {name: "Qonitha Cleonima", age: 16, hobby: "Silat", instagram: "qoniitataa", photo: "image/Qoni.jpeg", religion: "Islam", organization: "Paskibra", gallery: [], birthDate: "", description: "Jago bela diri Silat, jangan macam-macam dengannya! anjay", quote: "Don't say you can't before you try."},
      {name: "Rafailah Andini", age: 16, hobby: "Nda tau", instagram: "rafailahandini", photo: "image/dini.jpg", religion: "Islam", organization: "OSIS/PMR", gallery: [], birthDate: "04-02", description: "Misterius", quote: "Brains, beauty, and books."},
      {name: "Raihanah Nadira", age: 16, hobby: "Nonton yutub", instagram: "raihanadiraa", photo: "image/Reihana.jpeg", religion: "Islam", organization: "Sega/Sanggar Seni", gallery: [], birthDate: "", description: "Misterius", quote: "Character is formed in the stormy waves of the world."},
      {name: "Rasya Az'Zahra", age: 16, hobby: "Basket", instagram: "rasya_azzahra", photo: "image/Rasyaa.jpg", religion: "Islam", organization: "Basket", gallery: [], birthDate: "", description: "Misterius", quote: "..."},
      {name: "Aulia", age: 16, hobby: "Menggambar", instagram: "auliaaa_dn", photo: "image/Aul.jpg", religion: "Islam", organization: "Paskibra", gallery: [], birthDate: "", description: "Misterius", quote: "Believe in yourself."},
      {name: "ACOK NI BOS", age: 15, hobby: "anu", instagram: "rrezxkyy30", photo: "image/Aco.jpeg", religion: "Islam", organization: "OSIS/Paskibra", gallery: [], birthDate: "01-30", description: "Cool, Keren, Gantenk, Beraura, Baik, Positip vibes, GrinFleg", quote: "Don't plan too much, some of the most beatiful moments in our lives are actually unplanned."},
      {name: "Syifa BTR", age: 16, hobby: "nda tau", instagram: "syfabhtr_", photo: "image/Cipa.jpg", religion: "Islam", organization: "KITS/Inteens/Sanggar/PPS", gallery: [], birthDate: "09-09", description: "#Bata Out", quote: "Always breathe until you die."},
      {name: "Vanezia", age: 15, hobby: "Menari", instagram: "vvsloav_19", photo: "image/Vanes.jpeg", religion: "Islam", organization: "Sanggar Seni", gallery: [], birthDate: "", description: "Pendek", quote: "There is no such thing as failure in this life, except when you give up when facing trials."},
      {name: "Wilyam", age: 15, hobby: "pegang konde", instagram: "ultraawill", photo: "image/Wilyam.jpg", religion: "Katolik", organization: "Smansa Voice", gallery: [], birthDate: "", description: "Hati-hati dengannya lengah dikit pegang konde", quote: "Stay cool, for sure"},
      {name: "Zahra Mauaja", age: 16, hobby: "Apa yak", instagram: "zhrmdkyya", photo: "image/Yayaa.jpg", religion: "Islam", organization: "Tahfidz", gallery: [], birthDate: "", description: "Zahra mau aja", quote: "Dame ungger? Ungkeh."},
      {name: "Zyqri Al Farezqhi", age: 15, hobby: "main roblox", instagram: "zyqrialfarezqhi18", photo: "image/Zyqri.jpg", religion: "Islam", organization: "KITS/PMR", gallery: [], birthDate: "01-18", description: "Teman Teka Nagym", quote: "Better to fail trying than to regret for doing nothing."},
    ];
    
    // Elemen DOM
    const container = document.getElementById('studentContainer');
    const modal = document.getElementById('studentModal');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImage');
    const lightboxCloseBtn = document.querySelector('.lightbox-close-btn');
    const viewportMeta = document.getElementById('viewportMeta');
    const DEFAULT_META = "width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no";
    const ZOOMABLE_META = "width=device-width, initial-scale=1, user-scalable=yes"; 

    let currentGalleryPhotos = []; 
    let currentPhotoIndex = 0;    

    // Lightbox
    function openLightBox(src, photos, index) {
        viewportMeta.content = ZOOMABLE_META; 
        currentGalleryPhotos = photos;
        currentPhotoIndex = index;
        lightboxImg.src = src;
        lightbox.style.display = 'flex'; 
        updateLightboxNav(); 
    }

    function closeLightBox() {
        viewportMeta.content = DEFAULT_META; 
        lightbox.style.display = 'none';
    }

    function updateLightboxNav() {
        let prevBtn = document.getElementById('lightboxPrevBtn');
        let nextBtn = document.getElementById('lightboxNextBtn');

        if (!prevBtn) {
            prevBtn = document.createElement('span');
            prevBtn.id = 'lightboxPrevBtn';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>'; 
            prevBtn.classList.add('lightbox-nav-btn', 'prev');
            prevBtn.onclick = (e) => { e.stopPropagation(); changePhoto(-1); };
            lightbox.appendChild(prevBtn);
            
            nextBtn = document.createElement('span');
            nextBtn.id = 'lightboxNextBtn';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>'; 
            nextBtn.classList.add('lightbox-nav-btn', 'next');
            nextBtn.onclick = (e) => { e.stopPropagation(); changePhoto(1); };
            lightbox.appendChild(nextBtn);
        }
        
        if (currentGalleryPhotos.length <= 1) {
             prevBtn.style.display = 'none';
             nextBtn.style.display = 'none';
             return;
        }

        prevBtn.style.display = 'flex'; 
        nextBtn.style.display = 'flex';
        prevBtn.style.visibility = (currentPhotoIndex === 0) ? 'hidden' : 'visible';
        nextBtn.style.visibility = (currentPhotoIndex === currentGalleryPhotos.length - 1) ? 'hidden' : 'visible';
    }

    function changePhoto(n) {
        let newIndex = currentPhotoIndex + n;
        if (newIndex >= 0 && newIndex < currentGalleryPhotos.length) {
            currentPhotoIndex = newIndex;
            lightboxImg.style.opacity = 0; 
            setTimeout(() => {
                lightboxImg.src = currentGalleryPhotos[currentPhotoIndex];
                lightboxImg.style.opacity = 1; 
                updateLightboxNav(); 
            }, 150); 
        }
    }

    // Stats
    function calculateAndDisplayStats() {
        const totalStudents = students.length;
        const today = new Date();
        const currentMonth = String(today.getMonth() + 1).padStart(2, '0');
        let birthdayCount = 0;
        const organizationCounts = {};
        
        students.forEach(s => {
            if (s.birthDate && s.birthDate.length >= 5 && s.birthDate.substring(0, 2) === currentMonth) {
                birthdayCount++;
            }
            const orgs = s.organization.split('/').map(o => o.trim()).filter(o => o !== 'Tidak Ada' && o !== 'gatau' && o !== '');
            orgs.forEach(org => {
                organizationCounts[org] = (organizationCounts[org] || 0) + 1;
            });
        });

        let mostPopularOrg = 'Belum Ada Data';
        let maxCount = 0;
        let tiedOrgs = [];

        for (const org in organizationCounts) {
            if (organizationCounts[org] > maxCount) {
                maxCount = organizationCounts[org];
                mostPopularOrg = org;
                tiedOrgs = [org];
            } else if (organizationCounts[org] === maxCount && maxCount > 0) {
                tiedOrgs.push(org);
            }
        }
        
        let orgDisplay;
        if (maxCount > 0) {
            if (tiedOrgs.length > 1) {
                orgDisplay = `${tiedOrgs[0]} & Lainnya`; 
            } else {
                orgDisplay = mostPopularOrg;
            }
        } else {
            orgDisplay = mostPopularOrg;
        }

        document.getElementById('statTotalStudents').textContent = totalStudents;
        document.getElementById('statBirthdayMonth').textContent = birthdayCount;
        document.getElementById('statMostOrganization').textContent = `${orgDisplay} (${maxCount})`;
    }

    // Search
    function filterStudents() {
        const input = document.getElementById('searchInput');
        const filterText = input.value.toUpperCase();
        const cards = container.getElementsByClassName('card');

        for (let i = 0; i < cards.length; i++) {
            const card = cards[i];
            const nameElement = card.querySelector('.name');
            const name = nameElement.textContent || nameElement.innerText;
            const nameMatch = name.toUpperCase().indexOf(filterText) > -1;
            if (nameMatch) {
                card.style.display = "";
            } else {
                card.style.display = "none";
            }
        }
    }

    // ==========================================
    // FITUR LOGIKA: LIKE & COMMENT
    // ==========================================
    
    let currentStudentName = ""; // Menyimpan nama siswa yang sedang dibuka modalnya
    let interactionListener = null; // Untuk mematikan listener firebase saat modal ditutup

    // 1. LISTEN GLOBAL LIKES UNTUK HALAMAN DEPAN
    function initGlobalLikeListener() {
        db.collection('student_interactions').onSnapshot((snapshot) => {
            snapshot.docChanges().forEach((change) => {
                // Kita pakai docChanges agar efisien, hanya update yang berubah
                const docId = change.doc.id; // Ini Nama Siswa
                const data = change.doc.data();
                const likes = data.likes || 0;

                // Cari kartu di halaman depan yang punya atribut data-name="Nama Siswa"
                // Kita harus escape tanda kutip di dalam querySelector
                const card = document.querySelector(`.card[data-name="${docId.replace(/"/g, '\\"')}"]`);
                
                if (card) {
                    const badgeValue = card.querySelector('.card-like-value');
                    if (badgeValue) {
                        badgeValue.textContent = likes;
                    }
                }
            });
        });
    }

    // Load Data Like & Comment (Realtime untuk Modal)
    function loadInteractions(name) {
        currentStudentName = name;
        const likeBtn = document.getElementById('likeBtn');
        const likeIcon = document.getElementById('likeIcon');
        const likeCountVal = document.getElementById('likeCountValue');
        const commentsList = document.getElementById('commentsList');
        const commentInput = document.getElementById('commentInput');

        // Reset UI
        likeCountVal.textContent = "...";
        commentsList.innerHTML = '<p class="no-comments">Memuat...</p>';
        commentInput.value = "";
        
        // Cek LocalStorage
        const hasLiked = localStorage.getItem(`liked_${currentStudentName}`);
        if (hasLiked) {
            likeBtn.classList.add('liked');
            likeIcon.classList.remove('far');
            likeIcon.classList.add('fas'); 
        } else {
            likeBtn.classList.remove('liked');
            likeIcon.classList.remove('fas');
            likeIcon.classList.add('far'); 
        }

        // Setup Realtime Listener
        const docRef = db.collection('student_interactions').doc(currentStudentName);

        if (interactionListener) interactionListener(); 

        interactionListener = docRef.onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                likeCountVal.textContent = data.likes || 0;

                const comments = data.comments || [];
                if (comments.length === 0) {
                    commentsList.innerHTML = '<p class="no-comments">Belum ada komentar. Jadilah yang pertama!</p>';
                } else {
                    commentsList.innerHTML = '';
                    comments.reverse().forEach(c => {
                        const div = document.createElement('div');
                        div.className = 'comment-item';
                        let timeStr = "";
                        if(c.timestamp && c.timestamp.toDate) {
                           timeStr = c.timestamp.toDate().toLocaleDateString('id-ID') + " " + c.timestamp.toDate().toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
                        }
                        
                        div.innerHTML = `
                            <div class="comment-header">
                                <span>${c.user}</span>
                                <span style="font-weight:normal; opacity:0.7;">${timeStr}</span>
                            </div>
                            <div class="comment-text">${c.text}</div>
                        `;
                        commentsList.appendChild(div);
                    });
                }
            } else {
                likeCountVal.textContent = 0;
                commentsList.innerHTML = '<p class="no-comments">Belum ada komentar.</p>';
            }
        });
    }

    // Handle Klik Like
    function handleLike() {
        if (!currentStudentName) return;
        
        const docRef = db.collection('student_interactions').doc(currentStudentName);
        const isLiked = localStorage.getItem(`liked_${currentStudentName}`);
        
        if (isLiked) {
            docRef.set({
                likes: firebase.firestore.FieldValue.increment(-1)
            }, { merge: true });
            
            localStorage.removeItem(`liked_${currentStudentName}`);
            document.getElementById('likeBtn').classList.remove('liked');
            document.getElementById('likeIcon').className = 'far fa-heart';
            
        } else {
            docRef.set({
                likes: firebase.firestore.FieldValue.increment(1)
            }, { merge: true }); 
            
            localStorage.setItem(`liked_${currentStudentName}`, "true");
            document.getElementById('likeBtn').classList.add('liked');
            document.getElementById('likeIcon').className = 'fas fa-heart';
        }
    }

    // Handle Kirim Komentar
    function handleComment() {
        if (!currentStudentName) return;
        const input = document.getElementById('commentInput');
        const text = input.value.trim();

        if (text.length < 2) {
            alert("Komentar terlalu pendek!");
            return;
        }

        const user = "Anonim"; 
        const docRef = db.collection('student_interactions').doc(currentStudentName);
        
        const newComment = {
            user: user,
            text: text,
            timestamp: new Date()
        };

        docRef.set({
            comments: firebase.firestore.FieldValue.arrayUnion(newComment)
        }, { merge: true })
        .then(() => {
            input.value = ""; 
            document.getElementById('commentsList').scrollTop = 0;
        })
        .catch((error) => {
            console.error("Error adding comment: ", error);
            alert("Gagal mengirim komentar.");
        });
    }


    // ** SHOW DETAILS **
    async function showStudentDetails(student) {
        document.getElementById('modalPhoto').src = student.photo;
        document.getElementById('modalName').textContent = student.name;
        document.getElementById('modalAge').textContent = student.age;
        document.getElementById('modalHobby').textContent = student.hobby;
        
        let religion = student.religion || 'Tidak Diketahui';
        if (religion.includes('Prot  estan')) {
            religion = 'Protestan';
        }

        document.getElementById('modalReligion').textContent = religion;
        document.getElementById('modalOrganization').textContent = student.organization || 'Tidak Diketahui';
        
        const igLink = document.getElementById('modalInstagramLink');
        igLink.href = `https://instagram.com/${student.instagram}`;
        document.getElementById('modalInstagramHandle').textContent = student.instagram;

        const galleryGrid = document.getElementById('modalGallery');
        galleryGrid.innerHTML = 'Loading Gallery...'; 
        
        let galleryPhotos = student.gallery && student.gallery.length > 0 ? student.gallery : [student.photo]; 

        try {
            const galleryCollection = db.collection('studentsGallery');
            const snapshot = await galleryCollection.where('name', '==', student.name).limit(1).get();
            if (!snapshot.empty) {
                const firestoreData = snapshot.docs[0].data();
                if (firestoreData.galleryPhotos && firestoreData.galleryPhotos.length > 0) {
                    galleryPhotos = firestoreData.galleryPhotos;
                }
            }
        } catch (error) {
            console.error("Gagal akses Firestore:", error);
        }

        galleryGrid.innerHTML = '';
        galleryPhotos.forEach((url, index) => {
            const img = document.createElement('img');
            img.className = 'gallery-img';
            img.src = url;
            img.alt = `Foto ${student.name} ${index + 1}`;
            img.addEventListener('click', (e) => { 
                e.stopPropagation(); 
                openLightBox(url, galleryPhotos, index); 
            });
            galleryGrid.appendChild(img);
        });
        
        loadInteractions(student.name);

        modal.style.display = 'flex'; 
    }

    // Render Kartu Siswa (DENGAN BADGE LIKE)
    students.forEach((s, index) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('data-index', index); 
      card.setAttribute('data-name', s.name); // PENTING UNTUK FIND CARD

      card.innerHTML = `
        <div class="card-like-badge">
             <i class="fas fa-heart"></i> <span class="card-like-value">0</span>
        </div>
        <img class="photo" src="${s.photo}" alt="Foto ${s.name}" title="" />
        <div class="name">${s.name}</div>
        <div class="info"><span class="label">Umur:</span> ${s.age} tahun</div>
        <div class="info"><span class="label">Hobi:</span> ${s.hobby}</div>
        
        <div class="description">${s.description || 'Deskripsi belum diisi.'}</div> 
        
        <div class="info">
          <span class="label ig-label">Instagram:</span> 
          <a href="https://instagram.com/${s.instagram}" target="_blank" class="instagram-link">@${s.instagram}</a>
        </div>
      `;
      card.addEventListener('click', () => { showStudentDetails(students[index]); });
      container.appendChild(card);
      setTimeout(() => { card.classList.add('animate'); }, index * 100);
    });

    function closeStudentModal() { 
        modal.style.display = 'none'; 
        // Matikan listener agar hemat data
        if (interactionListener) {
            interactionListener(); 
            interactionListener = null;
        }
    }
    
    lightboxCloseBtn.onclick = function() { closeLightBox(); }
    
    window.onclick = function(event) {
      if (event.target == modal) { closeStudentModal(); }
      if (event.target == lightbox) { closeLightBox(); } 
      if (event.target == document.getElementById('quoteModal')) { closeQuoteModal(); }
      if (event.target == document.getElementById('menfessModal')) { closeMenfessModal(); }
    }

    // Lightbox swipe/nav logic
    window.addEventListener('keydown', function(e) {
        if (lightbox.style.display === 'flex') {
            if (e.key === 'ArrowLeft') changePhoto(-1);
            else if (e.key === 'ArrowRight') changePhoto(1);
        }
    });

    let touchstartX = 0;
    let touchendX = 0;
    lightboxImg.addEventListener('touchstart', function(event) {
        if (event.touches.length === 1) touchstartX = event.touches[0].screenX;
    }, false);
    lightboxImg.addEventListener('touchend', function(event) {
        if (lightbox.style.display === 'flex') {
            touchendX = event.changedTouches[0].screenX;
            handleGesture();
        }
    }, false);

    function handleGesture() {
        const minSwipeDistance = 50; 
        if (touchendX < touchstartX - minSwipeDistance) changePhoto(1);
        if (touchendX > touchstartX + minSwipeDistance) changePhoto(-1);
    }
    
    // Birthday Logic
    function checkBirthday() {
        const today = new Date();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const todayString = `${month}-${day}`;

        const birthdayStudents = students.filter(s => {
            if (s.birthDate && s.birthDate.length >= 5) {
                return s.birthDate.substring(0, 5) === todayString;
            }
            return false;
        });

        if (birthdayStudents.length > 0) {
            const modalUltah = document.getElementById('birthdayModal');
            const containerUltah = document.getElementById('birthdayPerson');
            containerUltah.innerHTML = '';

            birthdayStudents.forEach(s => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <img src="${s.photo}" style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid #ff4359; object-fit: cover; margin-bottom: 10px;">
                    <h3 style="color: #ffffff; margin: 0;">${s.name}</h3>
                `;
                containerUltah.appendChild(div);
            });

            modalUltah.style.display = 'flex';
            fireConfetti();
        }
    } 

    function closeBirthdayModal() {
        document.getElementById('birthdayModal').style.display = 'none';
    }
    
    function fireConfetti() {
        var duration = 3 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 10000 };
        function randomInRange(min, max) { return Math.random() * (max - min) + min; }

        var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) { return clearInterval(interval); }
            var particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }

    // Daily Quote
    const quotesCollection = [
        { text: "Sekolah itu tempat menuntut ilmu, bukan menuntut dia peka.", author: "Anonim" },
        { text: "janganlah kamu menjadi seperti ekspektasi seseorang tapi bertindaklah seperti keinginanmu walau nanti kamu gagal kamu akan tetap bahagia jika itu adalah pilihanmu", author: "KINK MUPLI" },
        { text: "Berdansalah, Karir Ini Tak Ada Akhirnya.", author: "hindia" },
        { text: "Kami sebenarnya bisa, cuma males aja", author: "Ibe" },
        { text: "Matematika mungkin rumit, tapi memahami kode cewek lebih rumit.", author: "Siswa Galau" },
        { text: "Jarak antara mimpi dan kenyataan itu namanya DISIPLIN.", author: "Motivasi Pagi" },
        { text: "Sukses itu berawal dari niat, bukan dari 'Besok aja deh'.", author: "Pengingat Diri" },
        { text: "Kejarlah impianmu, meski itu sampai ke kantin sekolah.", author: "Anak Lapar" },
        { text: "Sahabat itu seperti bintang, kadang tak terlihat tapi selalu ada.", author: "Bestie" },
        { text: "Jangan lupa bahagia hari ini, karena besok mungkin ada PR Fisika.", author: "Realita" },
        { text: "Pintar itu relatif, nyontek itu inisiatif (tapi jangan ditiru ya).", author: "Candaan Kelas" },
        { text: "Masa depan cerah dimulai dari bangun pagi, bukan scroll TikTok sampai pagi.", author: "Mamah Dedeh KW" },
        { text: "Hidup itu seperti ujian sekolah, banyak soal yang gak kita ngerti.", author: "Filosofi Siswa" },
        { text: "Kelas yang bersih mencerminkan siswa yang... takut didenda bendahara.", author: "Seksi Kebersihan" },
        { text: "Berakit-rakit ke hulu, berenang-renang ke tepian. Sakit-sakit dahulu, remidial kemudian.", author: "Pantun Gagal" },
        { text: "Jadilah versi terbaik dari dirimu sendiri, bukan versi KW dari orang lain.", author: "Motivasi" },
        { text: "Uang kas tolong dibayar ya teman-teman, jangan pura-pura lupa.", author: "Bendahara Galak" },
        { text: "Kalau mimpimu belum tercapai, coba tidur lagi.", author: "Kaum Rebaahan" },
        { text: "Bermimpilah setinggi langit. Jika engkau jatuh, engkau akan jatuh di antara bintang-bintang.", author: "Soekarno" },
        { text: "Kegagalan adalah kesuksesan yang tertunda... kalau kamu gak nyerah.", author: "Semangat!" }
    ];

    function displayDailyQuote() {
        const date = new Date().getDate();
        const index = date % quotesCollection.length;
        const todaysQuote = quotesCollection[index];

        document.getElementById('dailyQuote').textContent = `"${todaysQuote.text}"`;
        document.getElementById('dailyAuthor').textContent = `- ${todaysQuote.author}`;
    }

    // Running Quotes
    function renderStudentQuotes() {
        const track = document.getElementById('studentQuotesTrack');
        if (!track) return;
        const activeStudentsData = students.map((s, index) => ({...s, originalIndex: index}))
                                           .filter(s => s.quote && s.quote.length > 2);

        const createCard = (studentData) => {
            return `
                <div class="student-quote-card" onclick="openQuoteModal(${studentData.originalIndex})">
                    <div class="sq-text">"${studentData.quote}"</div>
                    <div class="sq-author">
                        <img src="${studentData.photo}" alt="icon"> ${studentData.name.split(' ')[0]}
                    </div>
                </div>
            `;
        };

        let allCardsHTML = '';
        activeStudentsData.forEach(studentData => {
            allCardsHTML += createCard(studentData);
        });
        track.innerHTML = allCardsHTML; 
    }

    function openQuoteModal(index) {
        if (clickBlocked) {
             clickBlocked = false; 
             return; 
        } 
        const s = students[index];
        const modal = document.getElementById('quoteModal');
        document.getElementById('quoteModalText').textContent = `"${s.quote}"`;
        document.getElementById('quoteModalName').textContent = s.name;
        document.getElementById('quoteModalPhoto').src = s.photo;
        modal.style.display = 'flex';
    }

    function closeQuoteModal() {
        document.getElementById('quoteModal').style.display = 'none';
    }

    // Scroll Logic
    const scrollWrapper = document.querySelector('.running-quotes-wrapper');
    let scrollInterval;
    let isDragging = false; 
    let clickBlocked = false; 
    let startX;
    let scrollLeft;
    let startPageX; 
    
    function startAutoScroll() {
        if (!scrollWrapper) return;
        if (scrollInterval) clearInterval(scrollInterval);
        
        const scrollSpeed = 0.5; 
        const intervalMs = 10;
        
        scrollInterval = setInterval(() => {
            if (isDragging) return; 
            scrollWrapper.scrollLeft += scrollSpeed; 
            if (scrollWrapper.scrollLeft + scrollWrapper.clientWidth >= scrollWrapper.scrollWidth - 1) {
                scrollWrapper.scrollLeft = 0; 
            }
        }, intervalMs);
    }

    function stopAutoScroll() {
        if (scrollInterval) {
            clearInterval(scrollInterval);
            scrollInterval = null;
        }
    }

    if (scrollWrapper) {
        const onMouseDown = (e) => {
            if (e.button !== 0) return; 
            isDragging = true;
            clickBlocked = false; 
            scrollWrapper.classList.add('active-drag');
            stopAutoScroll(); 
            startX = e.pageX - scrollWrapper.offsetLeft;
            startPageX = e.pageX; 
            scrollLeft = scrollWrapper.scrollLeft;
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
        };

        const onTouchStart = (e) => {
            if (e.touches.length !== 1) return;
            isDragging = true;
            clickBlocked = false; 
            scrollWrapper.classList.add('active-drag');
            stopAutoScroll(); 
            startX = e.touches[0].pageX - scrollWrapper.offsetLeft;
            startPageX = e.touches[0].pageX; 
            scrollLeft = scrollWrapper.scrollLeft;
            window.addEventListener('touchmove', onTouchMove, { passive: false });
            window.addEventListener('touchend', onTouchEnd);
        };
        
        const onMouseMove = (e) => {
            if (!isDragging) return;
            e.preventDefault(); 
            const x = e.pageX - scrollWrapper.offsetLeft;
            const walk = (x - startX) * 1.5; 
            scrollWrapper.scrollLeft = scrollLeft - walk; 
            if (Math.abs(e.pageX - startPageX) > 5) {
                clickBlocked = true;
            }
        };

        const onTouchMove = (e) => {
            if (!isDragging) return;
            if (e.touches.length !== 1) return; 
            const x = e.touches[0].pageX - scrollWrapper.offsetLeft;
            const walk = (x - startX) * 1.5;
            if (Math.abs(x - startX) > 10) { 
                e.preventDefault(); 
            }
            scrollWrapper.scrollLeft = scrollLeft - walk;
            if (Math.abs(e.touches[0].pageX - startPageX) > 5) {
                clickBlocked = true;
            }
        };
        
        const onMouseUp = () => {
            isDragging = false; 
            scrollWrapper.classList.remove('active-drag');
            window.removeEventListener('mousemove', onMouseMove);
            window.removeEventListener('mouseup', onMouseUp);
            setTimeout(startAutoScroll, 500); 
        };

        const onTouchEnd = () => {
            isDragging = false;
            scrollWrapper.classList.remove('active-drag');
            window.removeEventListener('touchmove', onTouchMove);
            window.removeEventListener('touchend', onTouchEnd);
            setTimeout(startAutoScroll, 500); 
        };

        scrollWrapper.addEventListener('mousedown', onMouseDown);
        scrollWrapper.addEventListener('touchstart', onTouchStart, { passive: true }); 
    }


    // Spotify Logic
    const spotifyIframe = document.getElementById('spotifyIframe');
    const playerContainer = document.getElementById('spotifyPlayerContainer');
    const toggleButton = document.getElementById('toggleButton');

    const trackIds = [
        '1Q7EgiMOuwDcB0PJC6AzON', '5TTGoX70AFrTvuEtqHK37S', '0mQRgmkyY3S2rtiLVzbhHj', 
        '62thhXr3NIiZrn0xbBHaZo', '1RHYrGWQx4GVCamxLeHbO7', '6XIrXswuUgynYqyVfV8mrx',
        '4nkRb1iWHIjvpVcWtCPzuY', '142W8Knp0JVzH32YDafuFQ', '2GBgiuXwY1KzJMA0gSAr9J',
        '0KKkJNfGyhkQ5aFogxQAPU', '3rPtS4nfpy7PsARctAWpzd', '1ShRHPAiiIrh0arZbSFmx1',
    ];

    function loadRandomSpotifyTrack() {
        if (!spotifyIframe || trackIds.length === 0) return;
        const randomIndex = Math.floor(Math.random() * trackIds.length);
        const randomTrackId = trackIds[randomIndex];
        const embedUrl = `https://open.spotify.com/embed/track/${randomTrackId}?utm_source=generator&theme=0&compact=1`;
        spotifyIframe.src = embedUrl;
    }

    function toggleSpotifyPlayer() {
        if (!playerContainer || !toggleButton) return;
        const isOpen = playerContainer.classList.contains('open');
        if (isOpen) {
            playerContainer.classList.remove('open');
            toggleButton.classList.remove('open');
            toggleButton.querySelector('i').className = 'fab fa-spotify'; 
        } else {
            playerContainer.classList.add('open');
            toggleButton.classList.add('open');
            toggleButton.querySelector('i').className = 'fas fa-chevron-down'; 
        }
    }
    
    // Menfess Logic
    function openMenfessModal() {
        document.getElementById('menfessModal').style.display = 'flex';
    }

    function closeMenfessModal() {
        document.getElementById('menfessModal').style.display = 'none';
        document.getElementById('menfessForm').reset();
    }
    
    async function saveMenfess(e) {
        e.preventDefault();
        const to = document.getElementById('menfessTo').value.trim() || 'All';
        const content = document.getElementById('menfessContent').value.trim();
        const from = document.getElementById('menfessFrom').value.trim() || 'Anonim';
        const submitBtn = document.querySelector('.menfess-submit-btn');

        if (content.length < 10) {
            alert('Isi pesan terlalu pendek (minimal 10 karakter).');
            return;
        }

        submitBtn.textContent = 'Mengirim...';
        submitBtn.disabled = true;

        try {
            await db.collection('menfess').add({
                to: to,
                content: content,
                from: from,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert('Menfess berhasil dikirim!');
            closeMenfessModal();
            setTimeout(loadMenfess, 1000); 
        } catch (error) {
            console.error("Error saat mengirim menfess: ", error);
            alert("Gagal mengirim menfess.");
        } finally {
            submitBtn.textContent = 'Kirim Menfess';
            submitBtn.disabled = false;
        }
    }

    async function loadMenfess() {
        const menfessGrid = document.getElementById('menfessGrid');
        if (!menfessGrid) return;
        menfessGrid.innerHTML = '<p style="text-align: center; color: #bdb6f0; width: 100%; grid-column: 1 / -1;">Memuat menfess...</p>';

        try {
            const snapshot = await db.collection('menfess').orderBy('timestamp', 'desc').limit(20).get();
            if (snapshot.empty) {
                menfessGrid.innerHTML = '<p style="text-align: center; color: #bdb6f0; width: 100%; grid-column: 1 / -1;">Belum ada pesan rahasia.</p>';
                return;
            }
            let menfessHTML = '';
            snapshot.docs.forEach(doc => {
                const data = doc.data();
                const to = data.to || 'All';
                const content = data.content || 'Pesan kosong';
                const from = data.from || 'Anonim';
                let dateStr = 'Baru Saja';
                if (data.timestamp && data.timestamp.toDate) {
                    const date = data.timestamp.toDate();
                    dateStr = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
                }
                menfessHTML += `
                    <div class="menfess-card">
                        <div class="menfess-to">Untuk: ${to}</div>
                        <div class="menfess-content">${content}</div>
                        <div class="menfess-footer">
                            <span class="menfess-from">Dari: ${from}</span>
                            <span class="menfess-date">${dateStr}</span>
                        </div>
                    </div>
                `;
            });
            menfessGrid.innerHTML = menfessHTML;
        } catch (error) {
            console.error("Error saat memuat menfess: ", error);
            menfessGrid.innerHTML = '<p style="text-align: center; color: #ff775c; width: 100%; grid-column: 1 / -1;">Gagal memuat menfess.</p>';
        }
    }


    // MAIN
    document.addEventListener('DOMContentLoaded', () => {
        checkBirthday(); 
        displayDailyQuote();
        calculateAndDisplayStats(); 
        renderStudentQuotes(); 
        startAutoScroll(); 
        loadRandomSpotifyTrack();
        initGlobalLikeListener(); // NEW: Jalankan listener like halaman depan
        
        if (toggleButton) {
            toggleButton.addEventListener('click', toggleSpotifyPlayer);
            toggleButton.querySelector('i').className = 'fab fa-spotify';
        }
        
        const menfessBtn = document.getElementById('menfessButton');
        if (menfessBtn) menfessBtn.addEventListener('click', openMenfessModal);
        
        const menfessForm = document.getElementById('menfessForm');
        if (menfessForm) menfessForm.addEventListener('submit', saveMenfess);

        loadMenfess();
    });
  </script>
</body>
</html>